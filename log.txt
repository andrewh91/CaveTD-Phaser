20241010
i tried littleJS and it seemed to lack multiple cameras, i looked up Phaser and think i'll have a go at this instead. 

as i found with the littleJS you need to run it from a server, vscode's live server should do, it explained that this is for  web browser security reasons.

so in vscode, using liveserver , which you need to download, you can use the file explorer in vscode to open your html file, you can also right click and click open in liveserver


you need to include the phaser library like so 

    <script src="//cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js"></script>
	
although maybe you could bundle that with the game?

so i'll just go through the tutorials on the website
https://phaser.io/tutorials/making-your-first-phaser-3-game/part1

20241015
resume tut

20241119
make a start
somehow i was using an old version of phaser, updated it, i've made it load from my local version instead of from online
created a dot image, got that to display, next scale it

20241121
made the player dot larger, try to move it, got smooth moving, next try to get it to conform to a grid
20241122
movement for the player should be like pokemon, move one grid space with one direciton button, and you can hold it to move continuously.
in order to achieve this i have made a playerMoveTimer that decreases if above 0 and is set to a positive value (playerMoveTimerStep) when you move, you are only allowed to move when it is 0. it counts down with delta time, so if the game lags it should move the same speed - actually i should also multiply the movement distance by delta time too, cos if the game was really slow, like if the playerMoveTimerStep was lower than the game update time we would be moving less frequently, however moving more than one space at once would complicate the collision detection and you could pass through a wall, so just keep playerMoveTimerStep relatively high
this works good enough, 

20241125
i want to be able to create a new player character on command, created a player class, give new players a colour derived from the player's index number 
now i want to experiment with making new cameras, i already have some code that spaces the cameras out in the order i like, try and get that to work, seems to work, need to make the borders look right though 

20241126 
playing with these cameras again, took a while but i got it to display a border around each camera. this border is in a separate scene for the UI. next i should test what removing cameras does, will this mess everything up?

20241127
added code to remove the cameras one by one, except the first camera, then redraw the borders and manage the camera positions again, seems to work well. i've also used set scroll to have the new camera target the passed in coords, which is the newly created player. #

so far the arrow keys move the player, press p to create a new player at the current player's position, with their own camera, the camera points at the new player. press r to remove the most recent camera. 

the players all use the arrow keys to move, and they spawn on top of each other, so they all always overlap. new players should have their own movement keys instead, or at least have a key to toggle the selected player.

i've created a dialog box that appears when you create a new player, new cursor keys are then assigned to this new player, this works. currently it's just the wasd keys that are given to the new player, but i want them to be user defined

next i will create a bit more dialog, saying something like, set new player movement keys, LEFT: RIGHT: UP: DOWN 
then i need to take the user input for those events and have it set up the keys 

20241128
created the dialog box for new player, instruct user to assign keys to the player, figured out how to take the user entered key and store that as that new player's movement key

so now the p key will create a new player, and a camera centred on that player then manage the positions of the cameras and add borders, then it will show a ui dialog box prompting the user to enter keys for the new player, these keys update on the screen as you do so, and are then bound to that player, seems to work well 

next i should comment the code!

20241129
adding some comments to the code

20241205
i want to create a tile class and have an array of these to create the map. so far i have just created a load of random coloured tiles, i need to create a map, the tiles need to have a terrain value dictating if the player can traverse it etc

20241207
see if i can make the random colour a bit better, made a incrementColour function for use with the player and tile, just for now 

20241208
made a tileMap and a way to edit the tile map

20241210
amendment to the mapSetTerrain method. i will make some walls by default and have the player interact with them - the player should not be able to move onto a wall. nor should it be able to move out of bounds - out of the map, make sure its default pos is in the map, this seems to work , works for new players too

20241216
amend the player update method
i think i will try and make a 'vehicle' next, vehicles are basically players that can interact with the terrain, they can create /destroy walls. so now any player can press the 'action' button to create a wall, i'll have to modify this so only vehicles can do it, and also this is like god mode, that is not exactly how vehicles will interact with terrain in the game

20241218
made some player methods to draw text on the player, made it so the tiles can have terrain value for path rubble or wall, 
created a vehicle class, the player must move into this then press cancel button (shift) to enter if it is unoccupied, cancel to exit
had to amend the ui to allow adding the cancel button

I've realised that i want to see if the player is on top of a vehicle to see if they should enter when i press the shift key, i could loop through all the vehicles to see if the position matches the player position, which should not be too expensive since there will not be very many vehicles at once, however i could instead add a vehicle variable to the map, which is updated when the vehicle moves, this would be an advantage is there were loads of vehicles - which there won't be but i want to use the same method or similar for enemies and there will be lots of them, best to keep it consistent, also it makes sense that things on the map can be accessed by the player through the passed in map reference
TODO
so now i need to add a vehicle variable to the map, may as well do one for player too, need to make sure these are updated when a player moves or is destroyed 

i want to make it so if the player is in a vehicle and moves into rubble, it picks it up - the player and vehicle will move to where the rubble was, the rubble will appear on the bottom left of the player position but need to make it smaller or something to show we are carrying it, 
similarly if we bump into a wall, the wall will become 2 bits of rubble, one on the ground and one we are carrying 
while carrying rubble you can press space to switch from dig mode to dump mode, now if you press a direction you dump one rubble, if you dump it on an existing pile of rubble, you make a wall. I also want to be able to dump rubble on a wall to strengthen the wall, but i need a symbol for that so the player knows how strong the wall is, maybe outline the wall or something 

20241219
i can now move the player onto the vehicle and press shift, this puts the player in the vehicle, now when the player moves the vehicle moves too, press shift again to get out then the player can move and the vehicle will stay still, tested with a second player and a second vehicle
i learned something new about dynamic property access, i created a print method in the mapData class to help show a text representation of the various variables of mapData.tiles[]

TODO
players should not be able to occupy the same space as other players, ever. 
vehicles  should not be able to occupy the same space as other vehicles, ever. 
doing so would mess up the mapData.tiles[].playerIndex / vehicleIndex. 
players can occupy the same space as a vehicle but only if it is empty 

i also need to make the vehicle interact with the walls and rubble etc

20241220
i will make vehicles be able to display how much rubble they carry
i have now made the methods needed for the vehicle to drill walls and rubble, this seems to work. i now need to make the vehicle be able to drop rubble
you can't drop the rubble where you currently are, so the action (space) button will have to switch mode, so that now the movement keys control the direction you want to dump the rubble instead of moving, this seems to work fine
i've made it switch back to move mode if you dump all rubble

TODO
if you dump extra rubble on the wall, it functions as intended, makes the wall basically have more rubble, but it makes it white because i didn't support a value above 2, fix that also make it more obvious what is happening, make text pop up saying 'entered' when you get in a vehicle and 'exited' and 'dump mode' and 'move mode' etc

players should not be able to occupy the same space as other players, ever. 
vehicles  should not be able to occupy the same space as other vehicles, ever. 
doing so would mess up the mapData.tiles[].playerIndex / vehicleIndex. 
players can occupy the same space as a vehicle but only if it is empty

20241223
players should now not be able to move into each other, vehicles should not be able to move into each other 
you should not be able to dump rubble on players or vehicles

now i want to make text pop up, created this in the uiScene, it can be called by the scene, the player has the scene passed in, so the player can have the text popup appear, so far for when getting in or out of vehicle, when switching between dump mode and move mode, when trying to switch to dump mode but rubble capacity is 0, when trying to drill but rubble capacity is full. there is only one popup which disappear after 2 seconds, but it will be overwritten and reappear else where if it is triggered again, so if player 1 gets in a vehicle the popup will appear but then reappear by player 2 if they get in a vehicle

made it so that if you give a wall a terrain value over 2 it just becomes black- whether it is 3 or 3,000 it will be black , when i do some proper art it will be more obvious what that value is.

TODO
next i want to create an enemy class, and some basic pathfinding, should create a better, maze like map too

20241230
i should create a way to read in map data from a text string, such that the terrain data output by the mapData.print("terrain") method can be plugged in to generate a map. the map data from print method already has line breaks on the end of each line, so from that you can work out the map width that was used for the map

I can now have maps read in by passing a string in to this method MapData.loadFromText(string); the string could be something like this 
'00,02,00,00,00,00,00,01,01,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,02,\n00,00,00,00,00,02,02,02,00,00,00,00,00,00,02,00,00,00,00,00,00,00,00,00,00,00,02'
which is just the first 2 lines of an example map, 00 is path, 01 is rubble and 02 is wall, you can have values 3 and above, which is just stronger walls. the highest value in the print method - which prints a text representation of the map to console, the highest value is 99 since it only uses 2 digits - which is so that it prints neatly in the console. you could type in a value over 99 if you like and the loadFromText method would deal with it, but i don't think i want a wall with anywhere near 99 value

TODO make a maze, make an enemy 

20250107
making a creature class
made a map, made a class to store the maps, already have a method to load them in from text file, and i made a sort of god mode in the player class - which i've commented out, but that can help create a new map in the future using space and shift keys.
TODO spawn a create on the right of the map, create some pathfinding for it

20250110
the creature class will share some functions with the player class, i think i should create a separate helper class and have them import that
fixed an error, i had gridStep defined as global but also defined in the main file, deleted it from the main file

so now i have a creature on screen 
TODO give the creature pathfinding so it can move
TODO move more methods of the player class to the helper class

TODO i add vehicle, player and creature index to the map, i think my intention is to use that to get the creature in the given coords, but the creature's index in the creature array could change, so i think i want a map or something or do not remove dead creatures from the array, instead mark them as dead and given the next creature that old index

20250113
moving functions from player to helper 
pathfinding - there are a few problems with moving turn based actors in a tile based map when the actors are not able to occupy the same position, 
1 if there are 5 actors adjacent to each other in a row, and they all want to go east, if we do not move the eastern one first then the others can not move- at least in this update, which will cause a break in this continuous line which is not a big problem but it looks odd that actors all travelling the same direction can get in each other's way 
2 2 actors meeting head to head in a corridor will be stuck forever as they are unable to pass each other
3 a continuous row of actors moving east will not allow an actor moving south to get past until the entire row has moved out the way

pathfinding will determine the -proposed direction to move in- for each creature, that can be north, east, south, west or stationary. 
the index of creatures with the same proposed direction will be added to an array named for each cardinal direction and stationary 
each array will be sorted based on the creatures position, so for the north array (the array of creatures all travelling north) the first creature should be the northern most creature
these 5 arrays are given a priority that will change after each pathfinding cycle, for example it will start, north, south, east, west, stationary, then north will go to the back of the queue so south,east, west, stationary, north 
once all creatures have been sorted into these 5 arrays, we start moving them, in order of priority, so in this example the north array will be processed first this time
when trying to move a creature to it's proposed position, there are 3 things that could happen;
1 if the creature's proposed position is free of creatures and is not contested it moves into that position
2 else if the direction is blocked by a creature then that proposed position is marked as contested on the map, with reference to the direction we want to move, and we examine if our own position is contested, if so and it is contested by opposite direction to our proposed direction, then we can resolve this conflict by both moving to our proposed positions and we can clear that direction data from the contested map for both spaces. otherwise the position will remain contested until next time
3 else if the proposed direction is already contested, check if it is contested by your direction, if so move into it - this means we have already been prevented from moving this way last time, and now the conflict is resolved by the priority system, clear your proposed direction from the contested map

TODO 
implement a simple pathfinding rule to move in a straight line to a goal
then implement the above complex movement rules
test several pathfinding scenarios
1 2 actors meeting head on, they should be able to swap positions once they realise thhey are contesting each others' spaces
2 1 actor trying to move through a continuous line of actors travelling perpendicular, when the priority is right, the line should break to let the lone actor through
3 4 way intersection 4 lines of actors meeting at one point, things should slow down and take turns but everyone should get through eventually 
4 2 dotted lines, by that i mean not continuous but alternating space, actor,space, actor, 2 dotted lines meeting perpendicular - what will happen? will they neatly thread through each other or will it cause a slow down and more spaces to open up ? 
5 same as 4 but what if the dotted lines go actor , space, space, actor, space space

20250114
made 2 creatures , made them walk towards a goal, they should meet in the middle and get stuck on each other
also made collisions between creatures and - terrain, players, vehicles, other creatures
made 2 continuous rows of creatures, one going east one going west, you can notice how one moves normally as the the leader has no creature in it's way, and the other turns from contiuous to a sort of dotted line of creatures, as the leader is at the back and the other creatures are in it's way - this is because i am updating the creatures movement in order of the index number of the creatures, which is arbitrary, when i implement the priority array properly we will be updating the creatures that intend on moving east in order of the eastern most creature, so the others will not have a creature in their way

now i want to implement the more complex movement rules, like the priority arrays
i will create a priority array class, that we pass a reference of in to each creature, i've created methods to loop through the priority arrays and to change the priority, which seems to work ok

if i add an index of a creature, that wants to travel north, to the north array, then i want to sort the array, or more efficiently i want to insert the new index in the correct order. 
the correct order will be northern most creatures first, (for the north array) 
since the north array should be sorted from the previous update, i can make use of that to efficiently add creatures that still want to go north to the north array, creatures that were in a different array previously - east, west, stationary or south, but now want to go north will be more complex to insert into the north array

often times i will process the creatures that want to go north in an order that was already largely sorted in order of most northern, because creatures that are travelling north most likely will go north again, so assuming this is true more often than not, we should use an insert sort. 

so for example, i have a list of creature indexes that travelled north previously, i go through one by one, starting with the most northern, if it wants to go north again, i will add it to the now empty north array, the next one i add will be either equally northern to the ones already in the array or less northern, so i will check the last item in the north array, if this item is less northern than that (which it should be) then we add it to the end of the array, if not check the second to last item etc. until we find the correct place to insert it -  
this only works for the north array and only if it was already empty. the east, west and stationary arrays will be sorted in ways irrelevant to northern-ness, the south array will be ordered in the opposite way to the north array, with southern most creatures appearing first in the south array, so we could maybe process the north array and south array at the same time, the south array in reverse order

as for the east, west and stationary arrays, these will have to be sorted in a less efficient way

so far i have 2 actors, one in the east that wants to move west and one in the west that wants to move east, they meet in the middle and are stopped by each other
after pathfinding, they are added to priority arrays based on their intended direction of travel, at the end of the movement update these arrays are saved into an 'old' version of the array and the arrays are cleared 

TODO
instead of going through the array of creatures, in the order of their index numbers, i want to change it so that i go through based on the priority array, 
i think i need to add the relevant x or y coord as well as the index to the priority array, to aid sorting
i need to implement the sorting, if i do these correctly the 2 continuous rows of creatures should stay continuous

20250123
made some changes, when adding a creature we should add it to the priority array, even though it does not have a proposed position yet, just add it as stationary, 
then loop through all the priority arrays to make one large array , called concat array,  of the items in order, i've done slice to ensure this is by value
then in the update method i will loop through the concat array to do pathfinding
pathfinding is currently just moving towards a preset goal
because we are doing this in the priority array, the northernmost creature from last update will be the first one to be processed this time, and therefore we can implement an efficient sorting method as we can assume the array is largely already sorted
so each pathfinding update will insert the creature in the correct position in the priority array
once we have looped through all the creatures and updated pathfinding, they will have been added to different priority arrays, so concat all the priority arrays again
and then loop through the priority arrays to updatePosition

i need to test my addAndSort method in priorityArray to make sure it works and is efficient, especially considering how the priorityArray changes the order of priority

this seems to work as intended, so the 2 continuous lines of creatures now move without breaking up into a dotted line of creatures

TODO 
test out how this copes with 2 lines of creatures that collide with each other

20250124
if 2 lines of creatures move into each others path:
at 90 degree angle -which ever line got there first will go first and the other will be obsturcted and wait until it's clear,
at 90 degree angle -if there is a broken line of creatures, the obstructed line might take advantage of that gap and move into it, but only if the priority array lets them move before the other line
if they meet head on, 180 degree angle- they will be obstructed and stay that way 
4 creatures meet in a intersection, whichever has priority moves into it first and they all get stuck

so i want a more involved way to handle these conflicts that arise when multiple creatures want to move to the same space

here is how i previously described the contested idea working 
when trying to move a creature to its proposed position, there are 3 things that could happen;
1 if the creature's proposed position is free of creatures and is not contested it moves into that position
2 else if the direction is blocked by a creature then that proposed position is marked as contested on the map, with reference to the direction we want to move, and we examine if our own position is contested, if so and it is contested by opposite direction to our proposed direction, then we can resolve this conflict by both moving to our proposed positions and we can clear that direction data from the contested map for both spaces. otherwise the position will remain contested until next time
3 else if the proposed direction is already contested, check if it is contested by your direction, if so move into it - this means we have already been prevented from moving this way last time, and now the conflict is resolved by the priority system, clear your proposed direction from the contested map

so i'll start by adding a contested variable to the map, think i need 4 actually
if the creature tries to move to a space but there is a creature already there;
it will test if the current position is already contested by the opposite direction, if so that means the creature that is blocking us from getting to our proposed position - is being blocked from it's proposed position by us, so we can swap these 2 creatures to resolve the conflict
then we clear that contested data, in fact we clear the contested data for any map position that a creature moves into or dies in, i.e a space that is vacated 

that should solve head on collisions but i also want the contested method to allow a line of creatures to stop to let another creature past, 

this seems to work ok, 

TODO I think i solved the head on collisions, but i need to start the solution for when one line intersects another 
 - before moving check if a space is contested, if so that means a creature with higher priority has been trying to move there before you so you should wait

20250128
so i need to do the logic for if there is no creature in the proposed position, but it is contested- 
if it's contested by our direction then we can move, if it is contested by another direction then we should wait and that other creature will move instead, 
this should result in a congo line of creatures allowing creatures moving across the line to interrupt the line

i made a really messy method called isContestedExcluding 
i've been in 2 or 3 minds how to handle the contested logic, i ended up going for 4 booleans for each tile, but that doesn't lend itself particularly well to this method

this seems to work, and i think i've implemented it as designed, so if it doesn't work i think that will be back to the drawing board on the logic front. 

so that's a milestone, implemented the movement system for creatures, now i can implement more complex pathfinding and it should still work the same way

TODO try more complex pathfinding

20250203
currently, a timer ticks down then all pathfinding and movement is calculated in one go for all creatures, 
could i instead share the load, doing a fraction of the work but more frequently? 
i've amended the update method to work on the pathfinding and movement in segments, currently 8 segments, so the update occurs 8 times more often, but the first 4 times it just does a quarter of the pathfinding, then then next 4 times it does a quarter of the movements then it resets - i think this should be fine, so long as all the pathfinding occurs before any movement occurs it's basically operating the same as before, just spread out over time
one potential pitfall of this, is i count the number of creatures at the start of the update, and only count again after each update segment has finished, so i could get an index out of bounds error if a creature is killed - however i was already minded not to remove creatures from their array when killed - instead simply mark them as dead. creatures that are newly created mid update, will simply have to wait until they are included in the array

TODO pathfinding


 